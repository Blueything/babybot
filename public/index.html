<!DOCTYPE html>
<html>
<head>
  <title>BabyBot</title>
</head>
<body>
  <h1>Add Baby Profile</h1>
  <form id="baby-form">
    <label>Name: <input type="text" id="name" required></label><br><br>
    <label>Age in Months: <input type="number" id="age" required></label><br><br>
    <label>Notes: <input type="text" id="notes"></label><br><br>
    <button type="submit">Add Baby</button>
  </form>

  <h2>Server Response:</h2>
  <pre id="response"></pre>

  <hr>

  <h1>Ask for Baby Health Advice</h1>
  <form id="advice-form">
    <label>Name: <input type="text" id="adv-name"></label><br><br>
    <label>Age in Months: <input type="number" id="adv-age" required></label><br><br>
    <label>Notes: <input type="text" id="adv-notes"></label><br><br>
    <button type="submit">Get Advice</button>
  </form>

  <h2>Advice:</h2>
  <pre id="advice-response"></pre>

  <hr>
<h1>All Baby Profiles</h1>
<button id="fetch-babies-btn">Show All Babies</button>
<pre id="babies-list"></pre>

<h3>Delete Baby</h3>
<label>Name: <input type="text" id="delete-name" required></label>
<button id="delete-btn">Delete Baby</button>
<pre id="delete-response"></pre>



<script>
  const form = document.getElementById('baby-form');
  const responseBox = document.getElementById('response');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
  const age = parseInt(document.getElementById('age').value);
  const notes = document.getElementById('notes').value.trim();

  // ‚úÖ Simple checks
  if (!name || name.length < 2) {
    responseBox.textContent = "‚ùó Please enter a valid name (2+ characters).";
    return;
  }

  if (isNaN(age) || age < 0 || age > 60) {
    responseBox.textContent = "‚ùó Age should be between 0 and 60 months.";
    return;
  }

  if (notes.length > 200) {
    responseBox.textContent = "‚ùó Notes are too long (max 200 chars).";
    return;
  }

    const query = `
      mutation AddBaby($name: String!, $ageInMonths: Int!, $notes: String) {
        addBabyProfile(name: $name, ageInMonths: $ageInMonths, notes: $notes) {
          name
          ageInMonths
          notes
        }
      }
    `;

    const variables = { name, ageInMonths: age, notes };

    try {
      const res = await fetch('http://localhost:8000/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables })
      });

      const json = await res.json();
      console.log(json); // Debug

      if (json.errors) {
        responseBox.textContent = "‚ùå Error: " + json.errors[0].message;
        return;
      }

      const baby = json.data?.addBabyProfile;
      if (!baby) {
        responseBox.textContent = "‚ö†Ô∏è No baby added.";
        return;
      }

      responseBox.textContent = `‚úÖ Baby ${baby.name} (age ${baby.ageInMonths} months) added successfully.`;
    } catch (err) {
      console.error(err);
      responseBox.textContent = "‚ùå Failed to add baby.";
    }
  });
</script>

<!-- For Get Advice-->
<script>
  const adviceForm = document.getElementById('advice-form');
  const adviceBox = document.getElementById('advice-response');

  adviceForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // Prevent page refresh

    const age = parseInt(document.getElementById('adv-age').value);

    if (isNaN(age) || age < 0 || age > 60) {
      adviceBox.textContent = "‚ùó Enter a valid age between 0‚Äì60 months.";
      return;
    }

    const query = `
      query GetLLMAdvice($ageInMonths: Int!) {
        babyLLMAdvice(ageInMonths: $ageInMonths) {
          message
          tips
        }
      }
    `;

    const variables = { ageInMonths: age };

    try {
      const res = await fetch('http://localhost:8000/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables })
      });

      const json = await res.json();
      console.log(json);

      if (json.errors) {
        adviceBox.textContent = "‚ùå Error: " + json.errors[0].message;
        return;
      }

      const advice = json.data?.babyLLMAdvice;
      if (!advice) {
        adviceBox.textContent = "‚ö†Ô∏è No advice returned.";
        return;
      }

      adviceBox.textContent = `üçº ${advice.message}\n\nüí° Tips:\n- ${advice.tips.join("\n- ")}`;
    } catch (err) {
      console.error(err);
      adviceBox.textContent = "‚ùå Failed to get advice.";
    }
  });
</script>
<script>
  const fetchBabiesBtn = document.getElementById("fetch-babies-btn");
const babiesList = document.getElementById("babies-list");

fetchBabiesBtn.addEventListener("click", async () => {
  const query = `
    query {
      allBabies {
        name
        ageInMonths
        notes
      }
    }
  `;

  try {
    const res = await fetch("http://localhost:8000/graphql", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query }),
    });
    const json = await res.json();

    if (json.errors) {
      babiesList.textContent = "‚ùå Error: " + json.errors[0].message;
      return;
    }

    const babies = json.data?.allBabies;
    if (!babies || babies.length === 0) {
      babiesList.textContent = "‚ö†Ô∏è No babies found.";
      return;
    }

    babiesList.textContent = babies
      .map(
        (b) =>
          `üë∂ ${b.name} ‚Äî Age: ${b.ageInMonths} months\nNotes: ${b.notes || "-"}` +
          "\n----------------------"
      )
      .join("\n");
  } catch (err) {
    console.error(err);
    babiesList.textContent = "‚ùå Failed to fetch babies.";
  }
});

</script>
<script>
    const deleteBtn = document.getElementById("delete-btn");
const deleteNameInput = document.getElementById("delete-name");
const deleteResponse = document.getElementById("delete-response");

deleteBtn.addEventListener("click", async () => {
  const name = deleteNameInput.value.trim();

  if (!name || name.length < 2) {
    deleteResponse.textContent = "‚ùó Please enter a valid name.";
    return;
  }

  const query = `
    mutation DeleteBaby($name: String!) {
      deleteBabyProfile(name: $name)
    }
  `;

  try {
    const res = await fetch("http://localhost:8000/graphql", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query, variables: { name } }),
    });

    const json = await res.json();

    if (json.errors) {
      deleteResponse.textContent = "‚ùå Error: " + json.errors[0].message;
      return;
    }

    const success = json.data?.deleteBabyProfile;
    if (success) {
      deleteResponse.textContent = `‚úÖ Baby "${name}" deleted.`;
      fetchBabiesBtn.click(); // üëà auto-refresh list
    } else {
      deleteResponse.textContent = `‚ö†Ô∏è Baby "${name}" not found.`;
    }
  } catch (err) {
    console.error(err);
    deleteResponse.textContent = "‚ùå Failed to delete baby.";
  }
});

</script>


</body>
</html>

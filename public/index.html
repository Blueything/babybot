<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="styles.css" />

  <title>BabyBot</title>
</head>
<body>
  <h1>üë∂ BabyBot Health Assistant</h1>

  <section style="margin-bottom: 2em;">
    <h2>Add Baby & Get Advice</h2>
    <form id="baby-form" style="max-width: 400px;">
      <label>Name:<br>
        <input type="text" id="name" required>
      </label><br><br>

      <label>Age in Months:<br>
        <input type="number" id="age" required min="0" max="60">
      </label><br><br>

      <label>Notes:<br>
        <input type="text" id="notes">
      </label><br><br>

      <button type="submit">Add Baby + Get Advice</button>
    </form>
<label>
  <input type="checkbox" id="premium" />
  I'm a premium user
</label>

    <div id="baby-response" style="margin-top: 1em;"></div>
    <div id="advice-response" style="margin-top: 1em;"></div>
  </section>



<script>
  const form = document.getElementById("baby-form");
const babyBox = document.getElementById("baby-response");
const adviceBox = document.getElementById("advice-response");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const age = parseInt(document.getElementById("age").value);
  const notes = document.getElementById("notes").value.trim();

  const isPremium = document.getElementById("premium").checked;
  const notesToSend = isPremium ? notes : null;

  //const variables = { name, ageInMonths: age, notes: notesToSend };


  if (!name || name.length < 2) {
    babyBox.innerHTML = "<p style='color:red;'>‚ùó Enter valid name.</p>";
    return;
  }

  if (isNaN(age) || age < 0 || age > 60) {
    babyBox.innerHTML = "<p style='color:red;'>‚ùó Age must be 0‚Äì60.</p>";
    return;
  }

  // Add baby mutation
  const addQuery = `
    mutation AddBaby($name: String!, $ageInMonths: Int!, $notes: String) {
      addBabyProfile(name: $name, ageInMonths: $ageInMonths, notes: $notes) {
        name
        ageInMonths
      }
    }
  `;

  const variables = { name, ageInMonths: age, notes };

  try {
    const res = await fetch("http://localhost:8000/graphql", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: addQuery, variables }),
    });

    const json = await res.json();

    if (json.errors) {
      babyBox.innerHTML = `<p style='color:red;'>‚ùå Error: ${json.errors[0].message}</p>`;
      return;
    }

    const baby = json.data.addBabyProfile;
    babyBox.innerHTML = `<p style='color:green;'>‚úÖ Baby ${baby.name} added successfully.</p>`;

    // Now auto-get advice!
    // Advice query
const adviceQuery = `
  query GetLLMAdvice($ageInMonths: Int!, $notes: String) {
    babyLLMAdvice(ageInMonths: $ageInMonths, notes: $notes) {
      message
      tips
    }
  }
`;

const adviceRes = await fetch("http://localhost:8000/graphql", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: adviceQuery,
    variables: {
      ageInMonths: baby.ageInMonths,
      notes: isPremium ? notes : null
    },
  }),
});


    const adviceJson = await adviceRes.json();
    console.log(adviceJson); // üëà See what you get
    if (adviceJson.errors) {
  console.log("GRAPHQL ERROR:", adviceJson.errors);
}



    const advice = adviceJson.data.babyLLMAdvice;

    adviceBox.innerHTML = `
      <div style="padding: 1em; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9;">
        <p>üçº <strong>${advice.message}</strong></p>
        <ul>
          ${advice.tips.map((tip) => `<li>${tip}</li>`).join("")}
        </ul>
      </div>
    `;
  } catch (err) {
    console.error(err);
    babyBox.innerHTML = "<p style='color:red;'>‚ùå Failed to add baby.</p>";
  }
});



</script>

<!-- For Get Advice
<script>
  const adviceForm = document.getElementById('advice-form');
  const adviceBox = document.getElementById('advice-response');

  adviceForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // Prevent page refresh

    const age = parseInt(document.getElementById('adv-age').value);

    if (isNaN(age) || age < 0 || age > 60) {
      adviceBox.textContent = "‚ùó Enter a valid age between 0‚Äì60 months.";
      return;
    }

    const query = `
      query GetLLMAdvice($ageInMonths: Int!) {
        babyLLMAdvice(ageInMonths: $ageInMonths) {
          message
          tips
        }
      }
    `;

    const variables = { ageInMonths: age };

    try {
      const res = await fetch('http://localhost:8000/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables })
      });

      const json = await res.json();
      console.log(json);

      if (json.errors) {
        adviceBox.textContent = "‚ùå Error: " + json.errors[0].message;
        return;
      }

      const advice = json.data?.babyLLMAdvice;
      if (!advice) {
        adviceBox.textContent = "‚ö†Ô∏è No advice returned.";
        return;
      }

      adviceBox.textContent = `üçº ${advice.message}\n\nüí° Tips:\n- ${advice.tips.join("\n- ")}`;
    } catch (err) {
      console.error(err);
      adviceBox.textContent = "‚ùå Failed to get advice.";
    }
  });
</script>
<script>
  const fetchBabiesBtn = document.getElementById("fetch-babies-btn");
const babiesList = document.getElementById("babies-list");

fetchBabiesBtn.addEventListener("click", async () => {
  const query = `
    query {
      allBabies {
        name
        ageInMonths
        notes
      }
    }
  `;

  try {
    const res = await fetch("http://localhost:8000/graphql", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query }),
    });
    const json = await res.json();

    if (json.errors) {
      babiesList.textContent = "‚ùå Error: " + json.errors[0].message;
      return;
    }

    const babies = json.data?.allBabies;
    if (!babies || babies.length === 0) {
      babiesList.textContent = "‚ö†Ô∏è No babies found.";
      return;
    }

    babiesList.textContent = babies
      .map(
        (b) =>
          `üë∂ ${b.name} ‚Äî Age: ${b.ageInMonths} months\nNotes: ${b.notes || "-"}` +
          "\n----------------------"
      )
      .join("\n");
  } catch (err) {
    console.error(err);
    babiesList.textContent = "‚ùå Failed to fetch babies.";
  }
});

</script>
<script>
    const deleteBtn = document.getElementById("delete-btn");
const deleteNameInput = document.getElementById("delete-name");
const deleteResponse = document.getElementById("delete-response");

deleteBtn.addEventListener("click", async () => {
  const name = deleteNameInput.value.trim();

  if (!name || name.length < 2) {
    deleteResponse.textContent = "‚ùó Please enter a valid name.";
    return;
  }

  const query = `
    mutation DeleteBaby($name: String!) {
      deleteBabyProfile(name: $name)
    }
  `;

  try {
    const res = await fetch("http://localhost:8000/graphql", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query, variables: { name } }),
    });

    const json = await res.json();

    if (json.errors) {
      deleteResponse.textContent = "‚ùå Error: " + json.errors[0].message;
      return;
    }

    const success = json.data?.deleteBabyProfile;
    if (success) {
      deleteResponse.textContent = `‚úÖ Baby "${name}" deleted.`;
      fetchBabiesBtn.click(); // üëà auto-refresh list
    } else {
      deleteResponse.textContent = `‚ö†Ô∏è Baby "${name}" not found.`;
    }
  } catch (err) {
    console.error(err);
    deleteResponse.textContent = "‚ùå Failed to delete baby.";
  }
});

</script>
 -->

</body>
</html>
